[build]
target = "xtensa-esp32s3-espidf"
rustflags = [
    "--cfg", "mio_unsupported_force_poll_poll",
    "-C", "default-linker-libraries",
]

[target.xtensa-esp32s3-espidf]
linker = "ldproxy"
runner = "espflash flash --monitor"

[target.xtensa-esp32-espidf]
linker = "ldproxy"
runner = "espflash flash --monitor"

[unstable]
build-std = ["std", "panic_abort"]

[env]
ESP_IDF_VERSION = "v5.2"
# Default: hardware build (USB_SERIAL_JTAG as secondary console)
ESP_IDF_SDKCONFIG_DEFAULTS = "config/sdkconfig.defaults"

[alias]
# QEMU build: plain ESP32 target with UART-only console (ESP32-S3 QEMU has stdout bug)
build-qemu = ["build", "--release", "--target", "xtensa-esp32-espidf", "--config", "env.ESP_IDF_SDKCONFIG_DEFAULTS='config/sdkconfig.defaults;config/sdkconfig.qemu'"]
