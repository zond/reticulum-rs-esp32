# Default target is host (normal Rust project behavior)
# For ESP32 builds, use --target explicitly

[build]
rustflags = [
    "--cfg", "mio_unsupported_force_poll_poll",
]

# ESP32-S3 (hardware)
[target.xtensa-esp32s3-espidf]
linker = "ldproxy"
rustflags = ["-C", "default-linker-libraries"]

# ESP32 (QEMU)
[target.xtensa-esp32-espidf]
linker = "ldproxy"
rustflags = ["-C", "default-linker-libraries"]

[unstable]
build-std = ["std", "panic_abort"]

[env]
ESP_IDF_VERSION = "v5.2"
ESP_IDF_SDKCONFIG_DEFAULTS = "config/sdkconfig.defaults"

[alias]
# Build aliases (--no-default-features excludes test code from release)
build-esp32 = ["build", "--release", "--target", "xtensa-esp32s3-espidf", "--no-default-features", "--features", "esp32"]
build-qemu = ["build", "--release", "--target", "xtensa-esp32-espidf", "--no-default-features", "--features", "esp32"]
# Flash aliases - build and flash
flash-esp32 = ["run", "--bin", "flash-esp32"]
flash-qemu = ["run", "--bin", "flash-qemu"]
# Test alias - runs unit tests in QEMU
test-qemu = ["run", "--bin", "qemu-test-runner"]
# DANGER: Production flash with encryption - permanently burns eFuses!
production-flash = ["run", "--bin", "production-flash"]
