# Default target is host (normal Rust project behavior)
# For ESP32 builds, use --target explicitly

[build]
rustflags = [
    "--cfg", "mio_unsupported_force_poll_poll",
]

# ESP32-S3 (hardware)
[target.xtensa-esp32s3-espidf]
linker = "ldproxy"
rustflags = ["-C", "default-linker-libraries"]

# ESP32 (QEMU)
[target.xtensa-esp32-espidf]
linker = "ldproxy"
rustflags = ["-C", "default-linker-libraries"]

[unstable]
build-std = ["std", "panic_abort"]

[env]
ESP_IDF_VERSION = "v5.2"
ESP_IDF_SDKCONFIG_DEFAULTS = "config/sdkconfig.defaults"

[alias]
# Build and flash node to ESP32-S3
build-esp32 = ["build", "--bin", "node", "--release", "--target", "xtensa-esp32s3-espidf", "--features", "esp32"]
flash-esp32 = ["run", "--bin", "flash-esp32"]
# Run tests in QEMU (ESP32 environment without hardware)
test-qemu = ["run", "--bin", "qemu-test-runner"]
# DANGER: Production flash with encryption - permanently burns eFuses!
production-flash = ["run", "--bin", "production-flash"]
